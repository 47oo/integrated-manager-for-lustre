<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Hydra Dashboard</title>
<link rel="icon" href="{{STATIC_URL}}images/whamcloud.ico" />
<link rel="stylesheet" href="{{STATIC_URL}}css/clo_Base.css" type="text/css" />
<link href="{{STATIC_URL}}css/clo_BreadCrumb.css" rel="stylesheet" type="text/css" />
<link href="{{STATIC_URL}}css/clo_tabs.css" rel="stylesheet" type="text/css" />
<link href="{{STATIC_URL}}css/demo_table.css" rel="stylesheet" type="text/css" />
<link href="{{STATIC_URL}}css/smoothness/jquery-ui-1.8.16.custom.css" rel="stylesheet" type="text/css" />
<link href="{{STATIC_URL}}css/demo_page.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="{{STATIC_URL}}js/jquery-1.6.4.min.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery.jBreadCrumb.1.1.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery.idTabs.min.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery-ui-1.8.16.custom.min.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/highcharts.js" ></script>
<script type="text/javascript" src="{{STATIC_URL}}js/alerts_events.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/configure_dialog.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jqeasy.dropdown.min.js"></script>
<script type="text/javascript" language="javascript" src="{{STATIC_URL}}js/jquery.dataTables.js"></script>
<!-- Added for datetime picker -->
<script type="text/javascript" src="{{STATIC_URL}}js/jquery-ui-timepicker-addon.js"></script>
<!-------------------------------->
<script language="javascript" type="text/javascript">
$(document).ready(function() 
{
  var fromDate = new Date();
  fromDate.setHours(fromDate.getHours()-1);  // Current hour - 1
  
  var toDate = new Date();
  
  $('#datetime_from').datetimepicker();
  $('#datetime_from').datetimepicker('setDate', (fromDate) );
  $('#datetime_to').datetimepicker();
  $('#datetime_to').datetimepicker('setDate', (new Date()) );
  
  setActiveMenu('logs_menu');
  
  var lustre=true;
  fromDate = $('#datetime_from').val();
  toDate = $('#datetime_to').val();
  
  //LoadLogs("all_log_content",date,month,"true");
  var oTable = $('#all_log_content').dataTable( {
  "bDeferRender": true,
  "sAjaxDataProp": "response",
  "bProcessing": true,
  "iDisplayLength":100,
  "bDeferRender": true,
  "sAjaxSource": '/api/getlogs/',
  "fnServerData": function ( sSource, aoData, fnCallback ) {
  $.ajax({
  "dataType": 'json', 
  "type": "POST", 
  "url": sSource, 
  "data": JSON.stringify({'lustre':lustre,'start_time': fromDate,'end_time': toDate}),
  "contentType": "application/json; charset=utf-8",
  "success": fnCallback
  })
  },
  "aoColumns": [
    { "sClass": 'log_line', "mDataProp":"date"},
    { "sClass": 'log_line', "mDataProp":"host" },
    { "sClass": 'log_line', "mDataProp":"service" },
    { "sClass": 'log_line', "mDataProp":"message" }
  ],
  "bJQueryUI": true,
  });
  
  $("#alertAnchor").click();
  //click handler for filter
  $('#log_filter_btn').click(function()
  {
    fromDate = $('#datetime_from').val();
    toDate = $('#datetime_to').val();
    
    if($('#id_only_lustre').is(":checked"))
    {
      lustre = true;
    }
    else
    {
      lustre = false;
    }
    RefreshTable('#all_log_content','/api/getlogs/', lustre, fromDate, toDate);
  });
  
function RefreshTable(tableId, urlData, lustre, fromDate, endDate)
{
  $(".dataTables_processing").css('visibility','visible');
  
  $.ajax({type: 'POST', url: urlData, dataType: 'json', 
  data: JSON.stringify({"lustre": lustre, "start_time": fromDate, "end_time":endDate }),
  contentType:"application/json; charset=utf-8"})
  .success(function(data, textStatus, jqXHR) 
  {
    table = $(tableId).dataTable();
    oSettings = table.fnSettings();
    table.fnClearTable(this);
    for (var i=0; i<data.response.length; i++)
    {
      table.oApi._fnAddData(oSettings, data.response[i]);
    }
    oSettings.aiDisplay = oSettings.aiDisplayMaster.slice();
    $(".dataTables_processing").css('visibility','hidden');
    table.fnDraw();
  });
}
});
</script>
<style type="">
.logs_all_ok {
  background-color: #BEE5FF;
  background-position: 4px 4px;
  background-repeat: no-repeat;
  border: 1px solid #00AA00;
  border-radius: 6px 6px 6px 6px;
  margin: 6px 0 0;
  padding: 4px 4px 4px 24px;
}
</style>
</head>
<body style="margin: 0px 0px 0px 0px; padding: 0px;">
  <div class="wrapper">
    <div class="bg">
    {% include 'header.html' %}
    {% include 'notification_slider.html' %}  
      <div class="rightpanel">
      <!-- Dashboard Div - Start -->
      <div id="dashboardDiv">
        <table width="100%" border="0" cellspacing="0" cellpadding="3" align="center" style="border: 1px;border-color: blue;" >
          <tr style="background-color:#cccccc;">
            <td width="40%">
              <div class="breadCrumbHolder module">
                <div id="breadCrumb0" class="breadCrumb module">
                  <ul style="float:left;">
                    <li>
                        <a href="/dashboard">All FileSystems</a> </li>
	                      <select id="fsSelect">
		                      <option value="">Select File System</option>
		                    </select>
                     </li>
                   </ul>
                 </div>
              </div>
            </td>
            <td width="60%">
              <div class="timeint">
                From:&nbsp;<input id="datetime_from" />&nbsp;To:&nbsp;<input id="datetime_to" />
                &nbsp;Only Lustre Messages:&nbsp;
                <input type="checkbox" id="id_only_lustre" name="only_lustre" checked="checked" value="true">
                &nbsp;<input value="Filter" id="log_filter_btn" type="button"></input>
              </div>
            </td>
          </tr>
          <tr>
            <td colspan="3">
              <fieldset>
                <table width="100%" border="0" cellspacing="0" cellpadding="0" class="display"  id="all_log_content">
                  <thead>
                    <tr>
                      <th width="14%">Log Created At</th>
                      <th width="15%">Host</th>
                      <th width="10%">Service</th>
                      <th width="61%">Message</th>
                    </tr>
                  </thead>
                  <tbody>
                  </tbody>
                </table>
              </fieldset>
              </h3>
            </td>
          </tr>
        </table>
      </div>
      <!-- Dashboard Div - End -->
    </div>
    <div style="clear:both;"></div>
    </div>
  </div>
</body>
</html>
