#!/usr/bin/env python

# ==============================
# Copyright 2011 Whamcloud, Inc.
# ==============================

import sys
import os
bin_dir = os.path.abspath(os.path.dirname(sys.modules['__main__'].__file__))
project_dir = "/usr/share/hydra-server"
sys.path.append(project_dir)

from django.core.management import setup_environ
import settings
setup_environ(settings)

from chroma_core.lib.service_config import log, ServiceConfig

if __name__ == '__main__':
    cc = ServiceConfig()
    try:
        command = sys.argv[1]
    except IndexError:
        log.error("Usage: %s <setup|validate|start|stop>" % sys.argv[0])
        sys.exit(-1)

    def print_errors(errors):
        if len(errors) == 0:
            log.info("OK.")
        else:
            log.error("Errors found:")
            for error in errors:
                log.error("  * %s" % error)

    if command == 'setup':
        print_errors(cc.setup())
    elif command == 'validate':
        print_errors(cc.validate())
    elif command == 'stop':
        cc.stop()
    elif command == 'start':
        cc.start()
    else:
        log.error("Invalid command '%s'" % command)
        sys.exit("-1")

