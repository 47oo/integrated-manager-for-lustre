<script language="javascript">


  function loadFilesystem(fs_id) {
    Api.get("filesystem/" + fs_id + "/", {}, 
    success_callback = function(filesystem)
    {
      /* FS summary fields */
      $('#bytes_used').html(filesystem.bytes_total - filesystem.bytes_free);
      $('#bytes_total').html(filesystem.bytes_total);
      $('#inodes_used').html(filesystem.files_total - filesystem.files_free);
      $('#inodes_total').html(filesystem.files_total);
      $('#ost_count').html(filesystem.osts.length);
      $('#mgs_name').html(filesystem.mgt.primary_server_name);
      $('#mds_name').html(filesystem.mdts[0].primary_server_name);
      $('#fs_alerts').html(alert_indicator_large_markup(filesystem.id, filesystem.content_type_id));
      $('#fs_name').html(filesystem.name);

      // Config param dialog
      populate_conf_param_table(filesystem.conf_params, "config_param_table");
      $('#advance_opts').click(function()
      {
        $('#configParam').dialog('open');
      });
    });

    $('#new_ost_dialog').dialog
    ({
      autoOpen: false,
      width: 1100,
      maxHeight:470,
      position:"center",
      show: "clip",
      modal: true,
      buttons: 
      {
        "Ok": 
        {
          text: "Ok",
          id: "ost_ok_button",
          click: function(){
            var fs_id = $('#fs_id').val();       
            var ost_lun_ids = fvc_get_value($('#new_ost_chooser'));
            CreateOSTs(fs_id, ost_lun_ids);
            $(this).dialog("close");
          }
        },
        "Cancel": function() { 
          $(this).dialog("close");
        }, 
      }
    });

    /* Tables of targets */
    var target_table_elements = ['#mgt_configuration_view', '#ost', '#mdt'];
    $.each(target_table_elements, function(i, selector) {
      $(selector).dataTable( {
        bInfo: false,
        "bProcessing": true,
        "bJQueryUI": true,
        "bFilter": false,
        "bPaginate": false, 
        "oLanguage": {
            "sEmptyTable": "No MGT to display"
        },
        "aoColumns": [
          { "sClass": 'txtleft' },
          { "sClass": 'txtleft' },
          { "sClass": 'txtleft' },
          { "sClass": 'txtleft' },
          { "sClass": 'txtleft' },
          { "sClass": 'txtcenter', bSortable: false},
          { "sClass": 'txtcenter', bSortable: false}
        ]
      });
    });

    loadFilesystemTargets(fs_id);

    // Create new OST button click handler. 
    fvc_button($("#new_ost_chooser"), {multi_select: true});
    $('#btnNewOST').click(function() {
      $('#new_ost_dialog').dialog('open');
      $('#new_ost_dialog').find('table').width("100%");
    });

    // Free space pie charts
    LoadFSGraph_EditFS(fs_id);
  }


  function loadFilesystemTargets(fs_id)
  {
    Api.get("target/", {filesystem_id : fs_id, limit: 0}, 
    success_callback = function(data)
    {  
      var targets = data.objects;
      $('#ost').dataTable().fnClearTable();
      $('#mdt').dataTable().fnClearTable();
      $('#mgt_configuration_view').dataTable().fnClearTable();

      $.each(targets, function(i, target)
      {
        row = [
                target_dialog_link(target),
                target.lun_name,
                target.primary_server_name,
                target.failover_server_name,
                target.active_host_name,
                stateTransitionButtons(target),
                notification_icons_markup(target.id, target.content_type_id)
              ]
        if (target.kind == "OST") {
          $('#ost').dataTable().fnAddData (row);
        } else if (target.kind == "MGT") {
          $('#mgt_configuration_view').dataTable().fnAddData (row);
        } else if (target.kind == "MDT") {
          $('#mdt').dataTable().fnAddData (row);
        }
      });
    });
  }
</script>

<h2 class='section_header' id='edit_fs_title'>Filesystem <span id='fs_name'/></h2>

<div style='float:left;'>
  <table class='fs'>
    <tr>
      <th>MGS:</th><td id='mgs_name'></td>
    </tr>
    <tr>
      <th>MDS:</th><td id='mds_name'></td>
    </tr>
    <tr>
      <th>No. OST:</th><td id='ost_count'></td>
    </tr>
    <tr>
      <th></th><td id='fs_alerts'></td>
    </tr>
  </table>
  <p>
    <button class='advanced' type="button" id="advance_opts">Advanced...</button>
  </p>
</div>

<div style='float:left; margin-left: 12px;'>
  <div id="editfs_space_usage"></div>
  <p align=center><span id="bytes_used"/>/<span id="bytes_total"/></p>
</div>
<div style='float:left; margin-left: 12px;'>
  <div id="editfs_inode_usage"></div>
  <p align=center><span id="inodes_used"/>/<span id="inodes_total"/>&nbsp;inodes</p>
</div>

<div style='clear:both;'></div>

<h2 class='section_header'>Management target</h2>
<table cellpadding="0" cellspacing="0" border="0" class="display" id="mgt_configuration_view" width="100%">
  <thead>
    <tr>
      <th width="12%">Name</th>
      <th width="15%">Volume</th>
      <th width="7%">Primary&nbsp;server</th>
      <th width="7%">Failover&nbsp;server</th>
      <th width="12%">Started&nbsp;on</th>
      <th width='1%'></th>
      <th width='1%'></th>
    </tr>
  </thead>
  <tbody id="example_content">
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  </tbody>
</table>

<h2 class='section_header'>Metadata target</h2>
<table cellpadding="0" cellspacing="0" border="0" class="display" id="mdt" width="100%">
  <thead>
    <tr>
      <th width="12%">Name</th>
      <th width="15%">Volume</th>
      <th width="7%">Primary&nbsp;server</th>
      <th width="7%">Failover&nbsp;server</th>
      <th width="12%">Started&nbsp;on</th>
      <th width='1%'></th>
      <th width='1%'></th>
    </tr>
  </thead>
  <tbody id="mdt_content">
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  </tbody>
</table>

<h2 class="section_header">Object store targets</h2>
<p><button class='add' type="button" id="btnNewOST">Create new OST</button></p>
<table cellpadding="0" cellspacing="0" border="0" class="display" id="ost" width="100%">
  <thead>
    <tr>
      <th width="12%">Name</th>
      <th width="15%">Volume</th>
      <th width="7%">Primary&nbsp;server</th>
      <th width="7%">Failover&nbsp;server</th>
      <th width="12%">Started&nbsp;on</th>
      <th width='1%'></th>
      <th width='1%'></th>
    </tr>
  </thead>
  <tbody id="ost_content">
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  </tbody>
</table>

<p align='right'>
  <a class='address_link button' href="filesystems">Back to filesystems</a>
</p>

</div>
