
<script type='text/javascript'>
    /* Populate table of storage resources */
    var resourceTable = null;
    function load_resource_table() {
        var selected = $('#resource_class_select option:selected').val()
        var tokens = selected.split(",")
        var module_name = tokens[0]
        var class_name = tokens[1]

        console.log("Loading resources...");
        invoke_api_call(api_get, "storage_resource/" + module_name + "/" + class_name + "/", {},
          success_callback = function(data) {
            console.log("... done loading resources...");
            if (resourceTable) {
                resourceTable.fnDestroy();
                resourceTable = null;
                $('#resource_table').html("")
            } 
            data.aoColumns.push({mDataProp: '_alert_markup', sWidth: "1%", bSortable: false})
            for (var i=0, iLen=data.aaData.length; i<iLen; i++) {
              data.aaData[i]._alert_markup = alert_indicator_markup(
                data.aaData[i].id, data.aaData[i].content_type_id); 
            }
            resourceTable = $('#resource_table').dataTable({
                "bJQueryUI": true,
                "bPaginate": true,
                "bAutoWidth": false,
                "aaData": data['aaData'],
                "iDisplayLength":25,
                "aoColumns": data['aoColumns'],
                fnInitComplete: function(oSettings) {
                  for (var i=0, iLen=oSettings.aoData.length; i<iLen; i++) {
                    if (oSettings.aoData[i]._aData._alerts.length > 0) {
                      oSettings.aoData[i].nTr.className += " resource_alert";
                    }
                  }
                }
            }); 

            $('#resource_table tbody tr').live('click', function() {
                var aPos = resourceTable.fnGetPosition(this);
                var data = resourceTable.fnGetData(aPos);
                var resource_record_id = data.id
            });
          }
      );
    }

    $(document).ready(function() {
        $('#resource_class_select').change(function() {
            load_resource_table();
        });
        /* Initial population of dropdown of resource classes */
        invoke_api_call(api_get, "storage_resource_class/", {},
          success_callback = function(data) {
            options = ""
            if (data.resource_classes.length == 0) {
              $('div#plugins_available').hide();
              /*$('div#plugins_unavailable').css('display', 'block')*/
              $('div#plugins_unavailable').show();
            } else {
              $.each(data.resource_classes, function(i, resource_class) {
                  options += "<option value='" + resource_class.plugin_name + "," + resource_class.class_name + "'>" + resource_class.label + "</option>"
              });
              $('#resource_class_select').html(options);

              /* Select the default resource class */
              $('#resource_class_select option[value="' + data.default_hint.plugin_name + "," + data.default_hint.class_name + '"]').attr('selected', 'selected');

              /* Initial population of table once we know our default-selected class */
              load_resource_table();
            }
          }
        );
    });
</script>


<div id="plugins_available">
  <h2 class='section_header'>Storage resources</h2>
  <p><button class='add storage_resource_create_link'>Add storage device...</button></p>
  <p>Filter: <select id='resource_class_select'></select>&nbsp;</p>
  <table class='display tight_lines' id='resource_table' width="100%">
  </table>
</div>
<div id="plugins_unavailable" style="display:none;">
  <h2 class='section_header'>No plugins found</h2>
  <p>No storage plugins are currently installed.  When storage plugins are installed,
  use this tab to configure and view storage resources such as controllers.</p>
</div>
